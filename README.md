# GRYN Whitebark Pine Bayesian Blister Rust

## Lydia M. Druin

#### Last Updated: 03/21/25

### Purpose:

This R Project is designed to be used to evaluate the Bayesian hierarchical occupancy model from Shanahan et al. 2021, developed by Wilson Wright, and update estimated prevalence of blister rust for all whitebark pine within the entire Greater Yellowstone Ecosystem.

### Overview:

#### Folders:

Folder "GRYN Whitebark Bayesian Blister Rust" contains the R project, including all below folders.

1.  "data" contains--

<!-- -->

a.  "metadata", has files involving metadata like the monitoring protocol and the data dictionary
b.  "raw_data", has raw data exports from the master whitebark pine database (via [rob.daley\@nps.gov](mailto:rob.daley@nps.gov){.email}); these files are not to be changed/altered. Additionally, files "transect_data.csv", "StandArea.csv", and "stand_hiking.csv" were generated by Wilson Wright (2019-20) and do not need updated UNLESS a new stand or transect is added to monitoring. **When investigating post-2023 data, the files "GYE_WBP_AllObservers...", "GYE_WBP_PresidingObserver...", and "GYE_WBP_ObserverPrecedence_byYear" will need updated with modern (including post-2023 data) versions!**
c.  "old_data", has old "raw" data files from Wilson Wright's work. NOTE: Files "multi_obs_data" and "single_obs_data" are derived from "GYE_WBP_MultiObserverData_andSingleObserverData_fromMaster...." and are simply the respective tabs/sheets saved as .csv files. No changes were made from receiving the certified data exports and saving as .csv files.
d.  "processed_data", files that are generated through the scripts of code
e.  "rds", has .rds files, which are files meant to store/save work between R sessions. NOTE: The files currently present in this folder, all tagged with "LMDDec2024" or "LMDDec2024_late" are the data and model results for the blister rust model through 2023.
f.  "review", has files for further reviewâ€“this includes information on the Raw Data Editing Log, data differences between LMD's 2024 work and WW's 2020 work.

<!-- -->

2.  "help" has files that may be helpful for operating R and/or this R project
3.  "output", has output files generated by the scripts of code and figures/plots generated by the code
4.  "R" (not applicable for this R project)
5.  "Rmd", has Rmarkdown files (not applicable for this R project)
6.  "scripts", has the scripts we will be running for this R project

#### Important Information Regarding Raw Data:

In 2024, we identified some cases where trees in the raw data were represented in a way that was not accurate once the data was processed in R. The chief cause of these cases were "come back to life"; where a tree was, at one point, observed as RD/D and then later observed as alive. Frequently, these trees would be marked as dying (and then still continuing to be alive) in processed data. To handle these cases, we elected to create a copy of the original raw data file and make appropriate edits. However, it is very reasonable to create R code to handle these cases in the future. Because these cases were so few (see "Raw Data Editing Log" for more info), we decided to manually review and edit the file instead of use R code.

*To Review the Edits made to the Raw Data:* Visit "data/raw_data/Raw Data Editing Log.xlsx" for the discrepancies identified, and the edits taken. The resulting edited raw data file has the tag "\_LMDedits" added to the end of the file name.

*To Identify DBH Odballs, as described in the Raw Data Editing Log:* Open "scripts/dbh_investigation.R" and run the code. It will produce two csv files in the "data/review" folder: one file of all trees present in the raw data, with an additional column showing the numeric change in DBH between earliest and latest measurements; and a second file of only trees with loss in DBH (change less than 0cm) or huge gains in DBH (change greater than 6cm). Work with Rob Daley to evaluate if these changes need scrutinizing!

#### Procedure:

**BEFORE STARTING:** Review the file "data/raw_data/Raw Data Editing Log.xlsx". This file contains changes made to the raw data file after export from the WBP Access database by R. Daley, as well as the reasoning being those edits. When using a NEW raw data file--examine the editing log and make changes as necessary to your new raw data file!

First, you will need to download R and R Studio. Visit <https://rstudio-education.github.io/hopr/starting.html> for instructions!\
**Note:** You can open the "GRYN Whitebark Summary and Plots.rproj" file, which will open this README file and the scripts files directly in R Studio once you have downloaded R Studio!

1.  Open "data_processing.R" contained in the "scripts" folder

2.  Follow the code and execute it by putting your cursor on each line/command you want to run and clicking "CTRL + Enter"

3.  To run the model and examine results, open and run the code in "scripts/bayesian_blisterrust.R".

4.  To generate model plots as seen in the Shanahan et al. 2021 pub, open and run the code in "scripts/summary_plots.R".

5.  To examine the original 2020 results from Wilson Wright's work, open and run the code in "scripts/replicating_WilsonsWork.R"--this script is Wilsons work copy+pasted and is **not necessary** to complete but may be helpful to have easily accessible.

    --Save plots created in the code by running the lines of "ggsave" (line directly follows each plot), by right-clicking each plot image and saving, OR by following the "/help/saving_images_in_R.doc" file

**Important Information about these Scripts:**

Unfortunately, "scripts/bayesian_blisterrust.R" and "scripts/model_plotting.R" are not fully automated to seamlessly incorporate new (post-2023) data without any editing by the user. I (LMD) have done my best to leave clear notes where the user will need to make minor edits in the code.

The worst of these is the .STAN file. Please consult the README_BEFORE_RUNNING_MODEL.txt file in the GRYN Whitebark Bayesian Blister Rust folder **before** running a model using post-2023 data.

##### Notes about R:

The pound symbol, #, indicates a "comment"--this is a bit of "code" that is not intended to do anything! By typing \# at the beginning of a line, R will effectively ignore this piece. It is a note to the user!

**Upon exiting R,** it will ask you if you want to save your workspace. This is totally optional! It means that when you open Rstudio/this project another time, everything in your workspace/"environment" will load again from the previous session. This is not a substitute for saving copies of your data!

#### Procedure when Incorporating post-2023 data:

1.  Load WBP database file exports into the "/data/raw_data/" folder: **these should be the files "GYE_WBP_AllObservers...", "GYE_WBP_PresidingObserver...", and "GYE_WBP_ObserverPrecedence_byYear"!**
2.  Review the Raw Data Editing Log; discuss with R Daley, E Shanahan, and/or K Legg if necessary! Maintaining data continuity and consistency is critical.
3.  Follow the prompts in the "data_processing.R" scripts for where you will make changes to the code in Step 1 to import your new raw data instead of pre-2024 raw data.
4.  Complete the remainder of the R Project's code as necessary.

### Notes:

1.  This code is designed to calculate the model-based blister rust prevalence estimates for whitebark pine (Shanahan et al. 2021).
2.  This code evaluates full-survey data only--not beetle-only survey data
3.  This code excludes BLM trees.
4.  This code uses multi-observer surveys! (Meaning, when a single tree was surveyed by 2+ people at the same time, all observers' surveys are used by this analysis)
5.  Contact Erin Shanahan ([erin_shanahan\@nps.gov](mailto:erin_shanahan@nps.gov){.email}) for WBP-specific questions, Rob Daley ([rob_daley\@nps.gov](mailto:rob_daley@nps.gov){.email}) for data- and data management-specific questions, and Kristin Legg ([kristin_legg\@nps.gov](mailto:kristin_legg@nps.gov){.email}) for program-specific questions. Lydia Druin (lydiadruin\@outlook.com) is available to answer R questions!

#### Disclaimer:

This R project is designed to calculate ratio estimators regarding trees monitored beginning in 2004 by the Interagency Whitebark Pine Monitoring Protocol of the National Park Service Greater Yellowstone Network, Inventory and Monitoring Division. Data and/or code and its products are not to be shared outside of GRYN without permission.
